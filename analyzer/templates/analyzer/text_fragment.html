{# analyzer/templates/analyzer/text_fragment.html #}

<div class="space-y-6 p-4 bg-white rounded-lg shadow-md">

  {# 1) Readability Metrics #}
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
      <!-- Reading Ease -->
      <div class="bg-white p-6 rounded-lg shadow">
        <div class="text-4xl font-bold text-indigo-900">
          {{ readability.flesch_reading_ease|floatformat:1 }}%
        </div>
        <div class="mt-2 text-sm uppercase text-gray-500">
          Reading Ease
        </div>
      </div>

      <!-- Grade Level -->
      <div class="bg-white p-6 rounded-lg shadow">
        <div class="text-4xl font-bold text-indigo-900">
          {{ readability.flesch_kincaid_grade|floatformat:1 }}
        </div>
        <div class="mt-2 text-sm uppercase text-gray-500">
          Grade Level
        </div>
      </div>

      <!-- Sentiment (example using TextRazor ‚Äúwords‚Äù sentiment or a default) -->
      <div class="bg-white p-6 rounded-lg shadow flex flex-col items-center justify-center">
        {% if sentiment == 'positive' %}
          <span class="text-5xl">üòä</span>
          <div class="mt-2 text-sm uppercase text-gray-500">Positive</div>
        {% elif sentiment == 'negative' %}
          <span class="text-5xl">‚òπÔ∏è</span>
          <div class="mt-2 text-sm uppercase text-gray-500">Negative</div>
        {% else %}
          <span class="text-5xl">üòê</span>
          <div class="mt-2 text-sm uppercase text-gray-500">Neutral</div>
        {% endif %}
      </div>
    </div>

    {# 2) Text Statistics #}
    <div class="mt-8">
    <h2 class="text-lg font-bold mb-4">Text Statistics</h2>
    <div class="grid grid-cols-1 sm:grid-cols-3 md:grid-cols-6 gap-4">
      <div class="bg-white p-4 rounded-lg shadow flex flex-col items-center justify-center">
        <div class="text-3xl font-bold text-indigo-900">
          {{ stats.sentences|floatformat:0 }}
        </div>
        <div class="mt-2 text-xs font-medium text-gray-500 uppercase text-center">
          Sentences
        </div>
      </div>
      <div class="bg-white p-4 rounded-lg shadow flex flex-col items-center justify-center">
        <div class="text-3xl font-bold text-indigo-900">
          {{ stats.words|floatformat:0 }}
        </div>
        <div class="mt-2 text-xs font-medium text-gray-500 uppercase text-center">
          Words
        </div>
      </div>
      <div class="bg-white p-4 rounded-lg shadow flex flex-col items-center justify-center">
        <div class="text-3xl font-bold text-indigo-900">
          {{ stats.complex_words|floatformat:0 }}
        </div>
        <div class="mt-2 text-xs font-medium text-gray-500 uppercase text-center">
          Complex Words
        </div>
      </div>
      <div class="bg-white p-4 rounded-lg shadow flex flex-col items-center justify-center">
        <div class="text-3xl font-bold text-indigo-900">
          {{ stats.percent_complex_words|floatformat:2 }}%
        </div>
        <div class="mt-2 text-xs font-medium text-gray-500 uppercase text-center">
          Percent of Complex Words
        </div>
      </div>
      <div class="bg-white p-4 rounded-lg shadow flex flex-col items-center justify-center">
        <div class="text-3xl font-bold text-indigo-900">
          {{ stats.avg_words_per_sentence|floatformat:2 }}
        </div>
        <div class="mt-2 text-xs font-medium text-gray-500 uppercase text-center">
          Average Words per Sentence
        </div>
      </div>
      <div class="bg-white p-4 rounded-lg shadow flex flex-col items-center justify-center">
        <div class="text-3xl font-bold text-indigo-900">
          {{ stats.avg_syllables_per_word|floatformat:2 }}
        </div>
        <div class="mt-2 text-xs font-medium text-gray-500 uppercase text-center">
          Average Syllables per Word
        </div>
      </div>
    </div>
  </div>




  {# 2) Primary suggestions with ‚ÄúInsert‚Äù buttons #}
  <div>
    <h2 class="text-lg font-bold mb-2">Recommended Keywords</h2>
    <div class="flex flex-wrap gap-3">
      {% for Keyword in suggestions %}
        <div class="flex items-center space-x-2 bg-indigo-100 px-3 py-2 rounded-full">
          <span class="font-medium text-indigo-800">{{ Keyword }}</span>
          <button
            hx-trigger="click"
            hx-swap-oob="true"
            hx-on="click: insertKeyword('{{ Keyword }}')"
            class="text-sm bg-indigo-600 hover:bg-indigo-700 text-white font-semibold rounded px-2 py-1"
          >
            Insert
          </button>
        </div>
      {% endfor %}
    </div>
  </div>

    {% if opportunities %}
    <div class="mt-8">
      <h2 class="text-lg font-bold mb-2">Optimization Opportunities</h2>
      <ul class="list-disc list-inside space-y-1">
        {% for item in opportunities %}
          <li class="text-indigo-700">{{ item }}</li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

  {# 3) Coarse Topics #}
  <div>
    <h2 class="text-lg font-bold mb-2">Coarse Topics</h2>
    <div class="flex flex-wrap gap-2">
      {% for ct in coarse_topics %}
        <span class="px-2 py-1 bg-gray-200 rounded text-gray-700 text-sm">
          {{ ct.label }}
        </span>
      {% endfor %}
    </div>
  </div>

  {# 4) Original Text Preview #}
  <div>
    <h2 class="text-lg font-bold mb-2">Text Preview</h2>
    <div id="text-preview" class="prose max-w-none p-4 border rounded bg-gray-50">
      {{ content|linebreaksbr }}
    </div>
  </div>
</div>

<script>
  // Simple insertion function: appends keyword to the end
  function insertKeyword(kw) {
    const preview = document.getElementById('text-preview');
    // decode HTML entities, then append
    let txt = preview.innerText.trim();
    preview.innerText = txt + ' ' + kw;
  }
</script>
